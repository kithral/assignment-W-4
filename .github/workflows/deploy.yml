# WORKFLOW DISABLED: Migrating to microservices architecture
# Re-enable when microservices deployment is ready
#
# To re-enable: Remove the 'if: false' condition from the build-and-deploy job
name: Deploy Server (DISABLED)

on:
  push:
    branches: [ "main" ]
    paths:
      - 'server/**'
      - 'shared/**'
      - 'Cargo.toml'
      - '.github/workflows/**'

jobs:
  build-and-deploy:
    # DISABLED: Set to false to prevent workflow from running
    # Change to 'if: true' or remove this line to re-enable
    if: false
    runs-on: self-hosted  # <--- This targets your Orange Pi runner

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Build Docker Image
      run: |
        docker build -t assignment-w4-server:latest -f server/Dockerfile .

    - name: Stop Old Server (if running)
      continue-on-error: true
      run: docker stop game-server || true

    - name: Remove Old Container
      continue-on-error: true
      run: docker rm game-server || true

    - name: Run New Server
      run: |
        docker run -d \
          --name game-server \
          --restart unless-stopped \
          -p 5000:5000/udp \
          assignment-w4-server:latest
